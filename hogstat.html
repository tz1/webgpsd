<html>
  <head><title>Harley Motorcycle Status</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <style>html {margin:0px;padding:0px;border:0px }</style>
    <style>body {margin:0px;padding:0px;border:0px }</style>
    <script type="text/javascript">

var canv,xh,wd,ht
var mx = 240;

function dodraw() {
    var elem = document.getElementById('myCanvas')
    canv = elem.getContext('2d')
    wd = window.innerWidth
    ht = window.innerHeight
    canv.canvas.width = wd
    canv.canvas.height = ht
    mx = ht;
    if( wd < mx )
      mx = wd;
    canv.fillStyle = '#000'
    canv.fillRect(0,0, wd,ht)
    xh=new XMLHttpRequest()
    setTimeout(update, 100)
}

function update() {
    if( wd != window.innerWidth ||
        ht != window.innerHeight ) {
        wd = window.innerWidth
        ht = window.innerHeight
        mx = ht;
        if( wd < mx )
            mx = wd;
        canv.canvas.width = wd
        canv.canvas.height = ht
    }

    xh.open("GET","x.hog", false)
    xh.send()
    hog = eval('('+xh.responseText+')', null)

    canv.fillStyle = '#000'
    canv.fillRect(0, 0, wd,ht)

    r = mx/2
    canv.lineWidth = r/50
    canv.strokeWidth = r/50

    canv.strokeStyle = '#880'
    canv.beginPath()
    canv.moveTo(19*r/10,r)
    canv.arc(r,r,9*r/10,0,Math.PI,true)
    canv.lineTo(19*r/10,r)
    canv.stroke()

    canv.strokeStyle = '#f00'
    canv.beginPath()
    canv.moveTo(19*r/10,19*r/10)
    canv.arc(r,19*r/10,9*r/10,0,Math.PI,true)
    canv.lineTo(19*r/10,19*r/10)
    canv.stroke()

    canv.lineWidth = r*4/10
    canv.strokeWidth = r*4/10

    canv.strokeStyle = '#CC0'
    canv.beginPath()
    canv.arc(r,r,7*r/10,Math.PI, Math.PI*(1+hog.speed/120000),false)
    canv.stroke()

    canv.strokeStyle = '#f00'
    canv.beginPath()
    canv.arc(r,19*r/10,7*r/10,Math.PI, Math.PI*(1+hog.rpm/8000000),false)
    canv.stroke()


    canv.fillStyle = '#0f0'
    if( hog.turn & 1 ) {
	canv.beginPath()
	canv.moveTo(19*r/10,3*r/10)
	canv.lineTo(17*r/10,2*r/10)
	canv.lineTo(17*r/10,4*r/10)
	canv.lineTo(19*r/10,3*r/10)
	canv.fill()
    }
    if( hog.turn & 2 ) {
	canv.beginPath()
	canv.moveTo(r/10,3*r/10)
	canv.lineTo(3*r/10,2*r/10)
	canv.lineTo(3*r/10,4*r/10)
	canv.lineTo(r/10,3*r/10)
	canv.fill()
    }

    canv.lineWidth = r/50
    canv.strokeWidth = r/50

    if( hog.full > 6 )
	hog.full = 6;
    if( hog.full > 2 ) {
	canv.fillStyle = '#0f0'
	canv.strokeStyle = '#0f0'
    }
    else if( hog.full > 1 ) {
	canv.fillStyle = '#ff0'
	canv.strokeStyle = '#ff0'
    }
    else {
	canv.fillStyle = '#f00'
	canv.strokeStyle = '#f00'
    }
    canv.beginPath()
    canv.moveTo(17*r/10,r)
    canv.lineTo(19*r/10,r)
    canv.lineTo(19*r/10,12*r/10)
    canv.lineTo(17*r/10,12*r/10)
    canv.lineTo(17*r/10,r)
    canv.stroke()

    full = (6 - hog.full)/3*r/10;
    canv.beginPath()
    canv.moveTo(19*r/10,12*r/10)
    canv.lineTo(17*r/10,12*r/10)
    canv.lineTo(17*r/10,r+full)
    canv.lineTo(19*r/10,r+full)
    canv.lineTo(19*r/10,12*r/10)
    canv.fill()

    canv.textAlign="center"
    canv.textBaseline="middle"
    canv.lineWidth = r/50
    canv.strokeWidth = r/50

    v = r / 3
    canv.font = v +"px sans-serif"
    canv.fillStyle = '#fff'

    canv.fillText(hog.rpm/1000, r,19*r/10-v/2)
    canv.fillText(Math.round(hog.speed/1000), r,r-v/2)

// clutch - neutral - gear
    if( hog.gear == -1 )
	hog.gear = 0;
    if( hog.neutral ) {
	canv.fillStyle = '#0f0'
	canv.fillText("N", r/5,r+v/2)
    }
    else if( hog.clut ) {
	canv.fillStyle = '#f80'
	canv.fillText(hog.gear, r/5,r+v/2)
    }
    else {
	canv.fillStyle = '#fff'
	canv.fillText(hog.gear, r/5,r+v/2)
    }

    v = r / 5
    canv.font = v +"px sans-serif"
    canv.fillStyle = '#fff'
    canv.fillText(hog.temp , 3*r/10, v)


//    v = r / 10
//    canv.font = v +"px sans-serif"
//    canv.fillStyle = '#fff'
//    line=10;
//    canv.fillText(hog.odo+" ODO", r, line++* v)
//    canv.fillText(hog.fuel+" FUEL", r, line++* v)

    setTimeout(update, 50)
}
</script>
  </head>
  <body onload="dodraw()">
    <div width: 100%; height: 100%; margin: 0px>
      <a href=/><canvas id="myCanvas">No Canvas.</a>
    </div>
  </body>
</html>
